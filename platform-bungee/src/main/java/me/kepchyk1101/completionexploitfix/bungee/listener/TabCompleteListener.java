package me.kepchyk1101.completionexploitfix.bungee.listener;

import lombok.AccessLevel;
import lombok.RequiredArgsConstructor;
import lombok.experimental.FieldDefaults;
import me.kepchyk1101.completionexploitfix.commons.TabCompleteValidator;
import net.md_5.bungee.api.ChatColor;
import net.md_5.bungee.api.chat.ComponentBuilder;
import net.md_5.bungee.api.event.TabCompleteEvent;
import net.md_5.bungee.api.plugin.Listener;
import net.md_5.bungee.event.EventHandler;

@RequiredArgsConstructor
@FieldDefaults(level = AccessLevel.PRIVATE, makeFinal = true)
public class TabCompleteListener implements Listener {

    @EventHandler
    public void onTabComplete(TabCompleteEvent event) {

        String request = event.getCursor();

        if (TabCompleteValidator.isRequestValid(request)) {
            return;
        }

        event.setCancelled(true);

        event.getSender().disconnect(
                new ComponentBuilder("Attempted exploit!").color(ChatColor.RED).create()
        );

    }

}
